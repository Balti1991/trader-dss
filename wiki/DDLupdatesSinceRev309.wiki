#summary DDL changes since r309

= Introduction =

These are the changes to the database structure since r309. They will continue until Release 0.2 when a new file will be started


= Details =

  * Add a column to show the trade opening or closing
{{{
alter table trades add column tr_type char(1);
}}}
 Then update the tr_type field by hand to set the transaction type. ('O' for open, 'C' for close) if you have existing transactions.

  * The primary key on holdings is too restrictive. Remove it
{{{
alter table holdings drop constraint holdings_pkey;
}}}
 remove the hid index
{{{
drop index idx_holdings_hid;
}}}
 Now add a primary key on hid
{{{
alter table holdings add primary key (hid);
}}}

  * Add a `hid` column to the trades table
{{{
alter table trades add column hid integer;
}}}

  * Noticed that the yahoo data is wrong in more than 600,000 records! It looks like simple mistakes not corruption. This to fix it. (Yeah, it's not DDL, I know)
{{{
update quotes set high=open where open > high;
update quotes set low=open where open < low;
update quotes set high=close where close > high;
update quotes set low=close where close < low;
}}}

  * The `update_all_exchange_indicators` function has changed to take an exchange as a parameter. This was needed to manage multiple exchanges in the database. Replace the definition with
{{{
\i functions/update_exchange_indicators.sql
}}}
  * Volume is bigger than numeric(12)! Need to switch to bigint to hold it. This is issue 69
{{{
alter table quotes alter column volume type bigint;
}}}